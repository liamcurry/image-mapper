var l=!1;
!function(){function E(a,b,c,e){this.x=a||0;this.y=b||0;this.b=c||1;this.a=e||1}function r(a,b,c,e){m.push(new E(a,b,c,e));k()}function k(){w=l}function s(a){a.clearRect(0,0,t,u)}function F(){G(F);if(!w){s(x);if(n.src){var a=n.width,b=n.height;g.setAttribute("width",a);g.setAttribute("height",b);t=a;u=b;k();x.drawImage(n,0,0)}for(a=m.length;a--;)m[a].d(x);w=!0}}function v(a){var b=g,c=H+I,e=J+K;do c+=b.offsetLeft,e+=b.offsetTop;while(b=b.offsetParent);d=a.pageX-c;f=a.pageY-e}var j=window,i=j.document,
m=[],y,g=i.getElementById("canvas2"),x=g.getContext("2d"),t=g.width,u=g.height,z=l,p=l,q=-1,w=l,G=j.requestAnimationFrame||j.mozRequestAnimationFrame||j.webkitRequestAnimationFrame||j.msRequestAnimationFrame||j.oRequestAnimationFrame,L="nw-resize,n-resize,ne-resize,w-resize,e-resize,sw-resize,s-resize,se-resize".split(","),A=i.createElement("canvas"),o=A.getContext("2d"),B=new FileReader,n=new Image,j=i.body,C,D,H,J,I,K,h,d,f;E.prototype={d:function(a){var b=this.x,c=this.y,e=this.b,d=this.a;a.fillStyle=
a===o?"#000":"rgba(220,205,65,0.7)";if(!(b>t||c>u||0>b+e||0>c+d))if(a.fillRect(b,c,e,d),h===this){a.strokeStyle="#cc0000";a.lineWidth=2;a.strokeRect(b,c,e,d);a.fillStyle="darkred";y=[{x:b-3,y:c-3},{x:b+e/2-3,y:c-3},{x:b+e-3,y:c-3},{x:b-3,y:c+d/2-3},{x:b+e-3,y:c+d/2-3},{x:b-3,y:c+d-3},{x:b+e/2-3,y:c+d-3},{x:b+e-3,y:c+d-3}];for(b=8;b--;)c=y[b],a.fillRect(c.x,c.y,6,6)}},c:function(a){for(var b in a)this[b]=a[b]}};A.height=u;A.width=t;g.h=function(){return l};i.defaultView&&i.defaultView.getComputedStyle&&
(i=i.defaultView.getComputedStyle(g,null),H=+i.paddingLeft||0,J=+i.paddingTop||0,I=+i.borderLeftWidth||0,K=+i.borderTopWidth||0);G(F);g.onmousedown=function(a){v(a);if(q!==-1)p=true;else{s(o);for(a=m.length;a--;){m[a].d(o,"black");if(o.getImageData(d,f,1,1).data[3]>0){h=m[a];C=d-h.x;D=f-h.y;h.x=d-C;h.y=f-D;z=true;k();s(o);return}}h=null;s(o);k()}};g.onmouseup=function(){p=z=l;q=-1};g.ondblclick=function(a){v(a);r(d-10,f-10,20,20)};g.onmousemove=function(a){if(z){v(a);h.c({x:d-C,y:f-D});k()}else if(p){var b=
h.x,c=h.y,e=h.b,g=h.a;h.c([{x:d,y:f,b:e+(b-d),a:g+(c-f)},{y:f,a:g+(c-f)},{y:f,b:d-b,a:g+(c-f)},{x:d,b:e+(b-d)},{b:d-b},{x:d,b:e+(b-d),a:f-c},{a:f-c},{b:d-b,a:f-c}][q]);k()}v(a);if(h&&!p){for(a=8;a--;){b=y[a];if(d>=b.x&&d<=b.x+6&&f>=b.y&&f<=b.y+6){q=a;k();this.style.cursor=L[a];return}}p=l;q=-1;this.style.cursor="auto"}};B.onload=function(a){console.log("img src");n.src=a.target.result;console.log(n);k()};B.onerror=function(a){console.log(a)};j.f=function(a){a.preventDefault();this.className="drag-over"};
j.e=function(a){a.preventDefault();this.className=""};j.g=function(a){a.preventDefault();console.log("dropped");this.className="";B.readAsDataURL(a.dataTransfer.files[0]);console.log(a.dataTransfer.files[0])};r(260,70,60,65);r(240,120,40,40);r(45,60,25,25)}();
